##### Что такое процесс?

**Процесс** -- это **экземпляр выполнения программы**. Это изолированная единица выполнения с собственным адресным
пространством, наборами файловых дескрипторов и другими ресурсами, управляемая ядром ОС.

У процесса есть:

- **адресное пространство** (код, данные, стек, куча);
- **контекст** (регистры, счётчик команд, состояние памяти);
- **привилегии** (UID, GID, capabilities);
- **таблица открытых файлов** (файловые дескрипторы);
- **список сигналов** к обработке.

Программа -- это статичный исполняемый файл (ELF, PE), содержащий код, данные и метаинформацию.

- Одному процессу (в конкретный момент времени) соответствует ровно одна программа.
- Одной программе может соответствовать МНОГО процессов (как минимум, можно несколько раз запустить одну программу).

##### Что такое pid, ppid?

- **PID (Process ID)** -- уникальный идентификатор процесса внутри системы. Выдаёся ядром при создании процесса.
- **PPID (Parent Process ID)** -- PID родительского процесса, который создал данный процесс (через `fork`).

Узнать свой PID можно из кода:

```c
#include <unistd.h>

int main() {
    pid_t mypid = getpid();       // мой PID
    pid_t parentpid = getppid();  // PID родителя
    printf("PID=%d, PPID=%d\n", mypid, parentpid);
    return 0;
}
```

Или из терминала:

```bash
echo $$              # PID текущей shell
ps                   # список процессов с их PID и PPID
```

##### Как посмотреть дерево процессов?

Используется команда `pstree`:

```bash
pstree                   # дерево всех процессов
pstree -p               # с показом PID
pstree -p -s <pid>      # дерево предков для конкретного процесса
pstree <user>           # только процессы юзера
```

Либо `ps` с опциями:

```bash
ps aux --forest         # процессы в формате дерева
ps -ejH                 # с иерархией (PPID)
```

Или графически:

```bash
pstree -G               # красивая ASCII-графика
```

##### Как посмотреть потребление памяти, потребление CPU каждым из процессов?

Используется `ps`:

```bash
ps aux                           # все процессы с %CPU и %MEM
ps aux --sort=-%mem             # отсортировано по памяти (убывание)
ps aux --sort=-%cpu             # отсортировано по CPU (убывание)
ps -eo pid,user,vsz,rss,comm    # кастомный формат (VSZ -- виртуальная память, RSS -- физическая)
```

Или `top`/`htop` для real-time мониторинга:

```bash
top                 # интерактивный монитор
top -p <pid>        # только конкретный процесс
htop                # улучшенная версия top
```

`VSZ` (Virtual Memory Size) -- размер виртуального адресного пространства процесса.  
`RSS` (Resident Set Size) -- размер физически выделенной памяти в RAM.

##### Что такое uid, euid и cwd данного процесса, как их узнать и как поменять?

- **UID (Real User ID)** -- реальный ID пользователя, который запустил процесс. Не меняется во время работы процесса.
- **EUID (Effective User ID)** -- идентификатор, который используется при проверке прав доступа ядром. Именно он
  определяет, есть ли права на открытие файла, bind порта и т.п.
- **CWD (Current Working Directory)** -- текущая рабочая директория процесса.

Обычно `uid == euid`, `gid == egid`, но различия бывают при использовании SUID/SGID файлов, `setuid()`/`setgid()` или
capabilities.

Пример: запуск `/usr/bin/passwd` обычным пользователем:

- `uid` = ID пользователя (например 1000);
- `euid` = 0 (root), потому что на файле стоит SUID‑бит.

Узнать из кода:

```c
#include <unistd.h>
#include <stdio.h>

int main() {
    printf("UID=%d, EUID=%d\n", getuid(), geteuid());
    
    char cwd[256];
    if (getcwd(cwd, sizeof(cwd)) != NULL) {
        printf("CWD=%s\n", cwd);
    }
    
    return 0;
}
```

Узнать из терминала:

```bash
ps -o pid,uid,euid,comm
readlink /proc/<pid>/cwd     # cwd -- это симлинк на рабочую директорию
```

Изменить в коде:

```c
#include <unistd.h>

// Изменить UID (обычно нужны привилегии root)
if (setuid(1000) == -1) {
    perror("setuid failed");
}

// Изменить текущую директорию
if (chdir("/tmp") == -1) {
    perror("chdir failed");
}

// Установить EUID без изменения UID (для setuid-биарней)
seteuid(new_euid);
```

Из терминала:

```bash
cd /tmp                     # поменять CWD текущего процесса (shell)
sudo -u user ./prog         # запустить с другим UID
```
