##### Стадии сборки

Сборка C++‑программы делится на несколько этапов.

1. **Препроцессинг**  
   Обработка директив `#include`, `#define`, `#if` и т.п.  
   Результат: обычный текстовый файл с уже подставленными заголовками и развёрнутыми макросами (часто с расширением
   `.i`).

2. **Компиляция**  
   Преобразование результата препроцессинга в ассемблер.  
   Результат: файл с ассемблерным кодом (обычно `.s`).

3. **Ассемблирование**  
   Преобразование ассемблера в машинный код.  
   Результат: **объектный файл** (обычно `.o`, ELF REL -- relocatable).

4. **Линковка**  
   Объединение нескольких объектных файлов и библиотек, разрешение всех внешних ссылок.  
   Результат: **исполняемый файл** (ELF EXEC или DYN/PIE) или библиотека (`.so`, `.a`).

##### Как увидеть, из каких этапов состоит сборка программы через g++?

```bash
g++ -v main.cpp
```

В выводе будет видно, что драйвер `g++` последовательно вызывает внутренние инструменты:

- `cc1plus` -- препроцессинг + компиляция в ассемблер;
- `as` -- ассемблирование;
- `collect2` / `ld` -- линковка.

##### Что получается в результате каждого из этапов? Как выполнить каждый из этапов по отдельности?

Только препроцессинг:

```bash
g++ -E main.cpp -o main.i
```

Препроцессинг + компиляция:

```bash
g++ -S main.cpp -o main.s
```

Ассемблирование (в объектный файл):

```bash
g++ -c main.s -o main.o
# либо напрямую из исходника:
g++ -c main.cpp -o main.o
```

Линковка

```bash
g++ main.cpp -o main
```

##### Чем объектный файл отличается от исполняемого?

Объектный файл отличается от бинарного (исполняемого файла) содержанием не разрешённых ссылок на функции.
То есть его нельзя запустить, так как определение некоторых функций ещё не найдено.

- Объектный файл (`main.o`):
    - тип ELF **REL** (Relocatable);
    - содержит машинный код и данные, но часть символов остаётся **неразрешённой** (в таблице символов будут записи
      `UND`);
    - не содержит точки входа `_start`, сам по себе не запускается.

- Исполняемый файл (`a.out`, `main`):
    - тип ELF **EXEC** или **DYN** (для PIE);
    - все внешние ссылки либо уже разрешены, либо описаны для динамического линковщика (через `.dynamic`, `.plt`, `.got`
      и т.д.);
    - задана точка входа (`_start`), файл может быть загружен ядром и запущен.

##### Как дизассемблировать исполняемый файл?

```bash
objdump -d a.out              # дизассемблирование в AT&T-синтаксисе
objdump -d -M intel a.out     # в Intel-синтаксисе
```

Либо через gdb:

```gdb
gdb ./a.out
(gdb) disassemble main
```